---
layout:     post
title:      永远不要低估用户
subtitle:   否则你迟早被他们玩死
date:       2018-04-23
author:     HelloMin
header-img: img/post-bg-tea.jpg
catalog: true
tags:
    - Design
---
午餐时间，mars同学给我讲了这么个[新闻](https://www.huxiu.com/article/241333.html)：

> 昨日中午，黑客利用以太坊 ERC-20 智能合约中 BatchOverFlow 漏洞中数据溢出的漏洞攻击与美图合作的公司美链 BEC 的智能合约，成功地向两个地址转出了天量级别的 BEC 代币，导致市场上海量 BEC 被抛售，该数字货币价值几近归零，给 BEC 市场交易带来了毁灭性打击。

文章很长，其实意思很简单；

BEC代币可以进行多人转账，例如，从账户A中，对B,C账户分别转账x金额。计算可知，A账户应该扣除2*x金额，B、C账户则分别应该增加x金额，这样的交易才是正确的。

然而，学计算机的同学们都懂的，程序中的整数是存在溢出的可能性的。黑客正是利用了给多人转账的函数中，计算总转账金额2*x的地方没有考虑溢出问题，一旦进行超过一定金额的转账计算，导致整数类型没有办法表达2*x这么大的值的时候，就会得出 2*x=0 这样的结论。于是，账户A的金额没有任何减少，而BC账户的金额却都得到了增加，这样的交易进行下去，黑客就可以空手套白狼，得到大量的币，卖出之后就可以套现了。

黑客厉害吗？能发现这个问题，黑客自然是厉害的。但是这更多的应该归咎于代币的不谨慎。转账的金额既然是用户决定的，那就需要考虑所有可能的值，用户怎么会按照你希望的路子走呢？更多时候，用户最喜欢不走寻常路...

之所以有这么个感慨，是因为最近正好和同事开发了一个给用户调戏的小程序。我们请用户上传一张带人脸的照片，在后台对照片上检测出来的人脸，利用机器学习算法，进行颜值打分，然后反馈给用户他/她的颜值分数。同时，我们会将得分前十的照片展示在小程序中，供用户欣赏。

且不说大家都上传了一些什么奇葩的照片（唐三彩的泥人儿照片，各种卡通人物...）给我们计算了，就是这前十的榜单，就惹出了大麻烦。首先，由于我们没有做去重，多次上传同一张高分图片，榜单会被刷单。一开始我们觉得这也许不是个问题，因为高分榜上都是几张明星照片，分数很高，很难超越了。

谁知，刚发布我们就被打脸了。

<img src="/img/post_img/facerating_shua.png" alt="榜单被刷了" width="250px"/>

不知道哪位可爱的用户（您出来我保证不...），把小程序截屏了！他把排名第一的那张图单独抠出来上传了，算法只知道美人儿又来了，全给了一样的最高分，于是，我们的榜单成功被耍了。

于是我们开始讨论给图片做去重。可是一旦开始感受到用户的创意，我们越发的觉得这个问题没有想象中的简单，如果用户换几个位置截图呢，如果他们调整一下照片的亮度呢，如果他们把前十的图片和别的敏感图片ps到一起然后上传呢...

细思极恐之后，我们怂怂的把榜单删除了。

事实证明，一旦你给予用户一定的自由度，就要做好被用户折腾的心理和代码准备。不管是从用户上传的图片中列出前十，还是让用户进行任意金额的转账，只要开了一扇门，就要做好被砸门的准备。

作为一个Coder,我确实很少从产品的角度去考虑这些问题。这次看到别人被耍了，自己也被耍了一把之后，才发现原来产品的设计并不是一件简单的事情。低估你的用户，总有一天会被他们惊喜。

还是不要惊喜我吧：）

PS:我们的颜值小程序还在开发状态，等准备好了，一定通知您来调戏：）
